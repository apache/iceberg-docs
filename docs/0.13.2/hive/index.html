<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=author content><title>Hive</title><link href=../css/bootstrap.css rel=stylesheet><link href=../css/markdown.css rel=stylesheet><link href=../css/katex.min.css rel=stylesheet><link href=../css/iceberg-theme.css rel=stylesheet><link href=../font-awesome-4.7.0/css/font-awesome.min.css rel=stylesheet type=text/css><link href="//fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic,700italic" rel=stylesheet type=text/css><link href=../css/termynal.css rel=stylesheet></head><body><head><script>function addAnchor(e){e.insertAdjacentHTML("beforeend",`<a href="#${e.id}" class="anchortag" ariaLabel="Anchor"> üîó </a>`)}document.addEventListener("DOMContentLoaded",function(){var e=document.querySelectorAll("h1[id], h2[id], h3[id], h4[id]");e&&e.forEach(addAnchor)})</script></head><nav class="navbar navbar-default" role=navigation><topsection><div class=navbar-fixed-top><div><button type=button class=navbar-toggle data-toggle=collapse data-target=div.sidebar>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span></button>
<a class="page-scroll navbar-brand" href=https://iceberg.apache.org/><img class=top-navbar-logo src=https://iceberg.apache.org/docs/0.13.2//img/iceberg-logo-icon.png> Apache Iceberg</a></div><div><input type=search class=form-control id=search-input placeholder=Search... maxlength=64 data-hotkeys=s/></div><div class=versions-dropdown><span>0.13.2</span> <i class="fa fa-chevron-down"></i><div class=versions-dropdown-content><ul><li class=versions-dropdown-selection><a href=https://iceberg.apache.org/docs/0.13.2/../latest>latest</a></li><li class=versions-dropdown-selection><a href=https://iceberg.apache.org/docs/0.13.2/../0.13.2>0.13.2</a></li><li class=versions-dropdown-selection><a href=https://iceberg.apache.org/docs/0.13.2/../0.13.1>0.13.1</a></li><li class=versions-dropdown-selection><a href=https://iceberg.apache.org/docs/0.13.2/../0.13.0>0.13.0</a></li><li class=versions-dropdown-selection><a href=https://iceberg.apache.org/docs/0.13.2/../0.12.1>0.12.1</a></li></ul></div></div></div><div class="navbar-menu-fixed-top navbar-pages-group"><div class=topnav-page-selection><a href=https://iceberg.apache.org/docs/0.13.2/../../spark-quickstart>Quickstart</a></div class="topnav-page-selection"><div class=topnav-page-selection><a id=active href=../docs/latest>Docs</a></div><div class=topnav-page-selection><a href=https://iceberg.apache.org/docs/0.13.2/../../releases>Releases</a></div class="topnav-page-selection"><div class=topnav-page-selection><a href=https://iceberg.apache.org/docs/0.13.2/../../roadmap>Roadmap</a></div class="topnav-page-selection"><div class=topnav-page-selection><a href=https://iceberg.apache.org/docs/0.13.2/../../blogs>Blogs</a></div class="topnav-page-selection"><div class=topnav-page-selection><a href=https://iceberg.apache.org/docs/0.13.2/../../talks>Talks</a></div class="topnav-page-selection"><div class=versions-dropdown><div class=topnav-page-selection><a href>Project</a> <i class="fa fa-chevron-down"></i></div class="topnav-page-selection"><div class=versions-dropdown-content><ul><li class=topnav-page-selection><a href=https://iceberg.apache.org/docs/0.13.2/../../community>Community</a></li class="topnav-page-selection"><li class=topnav-page-selection><a href=https://iceberg.apache.org/docs/0.13.2/../../spec>Spec</a></li class="topnav-page-selection"><li class=topnav-page-selection><a href=https://iceberg.apache.org/docs/0.13.2/../../view-spec>View Spec</a></li class="topnav-page-selection"><li class=topnav-page-selection><a href=https://iceberg.apache.org/docs/0.13.2/../../puffin-spec>Puffin Spec</a></li class="topnav-page-selection"><li class=topnav-page-selection><a href=https://iceberg.apache.org/docs/0.13.2/../../how-to-release>How To Release</a></li class="topnav-page-selection"><li class=topnav-page-selection><a href=https://iceberg.apache.org/docs/0.13.2/../../terms>Terms</a></li class="topnav-page-selection"></ul></div></div><div class=versions-dropdown><div class=topnav-page-selection><a href>ASF</a> <i class="fa fa-chevron-down"></i></div class="topnav-page-selection"><div class=versions-dropdown-content><ul><li class=topnav-page-selection><a target=_blank href=https://www.apache.org/foundation/sponsorship.html>Donate</a></li class="topnav-page-selection"><li class=topnav-page-selection><a target=_blank href=https://www.apache.org/events/current-event.html>Events</a></li class="topnav-page-selection"><li class=topnav-page-selection><a target=_blank href=https://www.apache.org/licenses/>License</a></li class="topnav-page-selection"><li class=topnav-page-selection><a target=_blank href=https://www.apache.org/security/>Security</a></li class="topnav-page-selection"><li class=topnav-page-selection><a target=_blank href=https://www.apache.org/foundation/thanks.html>Sponsors</a></li class="topnav-page-selection"></ul></div></div><div class=topnav-page-selection><a href=https://github.com/apache/iceberg target=_blank><img src=https://iceberg.apache.org/docs/0.13.2//img/GitHub-Mark.png target=_blank class=top-navbar-logo></a></div><div class=topnav-page-selection><a href=https://join.slack.com/t/apache-iceberg/shared_invite/zt-tlv0zjz6-jGJEkHfb1~heMCJA3Uycrg target=_blank><img src=https://iceberg.apache.org/docs/0.13.2//img/Slack_Mark_Web.png target=_blank class=top-navbar-logo></a></div></div></topsection></nav><section><div id=search-results-container><ul id=search-results></ul></div></section><body dir=" ltr"><section><div class="grid-container leftnav-and-toc"><div class="sidebar markdown-body"><div id=full><ul><li><a href=../><span>Introduction</span></a></li><li><a class="chevron-toggle collapsed" data-toggle=collapse data-parent=full href=#Tables><span>Tables</span>
<i class="fa fa-chevron-right"></i>
<i class="fa fa-chevron-down"></i></a></li><div id=Tables class=collapse><ul class=sub-menu><li><a href=../configuration/>Configuration</a></li><li><a href=../evolution/>Evolution</a></li><li><a href=../maintenance/>Maintenance</a></li><li><a href=../partitioning/>Partitioning</a></li><li><a href=../performance/>Performance</a></li><li><a href=../reliability/>Reliability</a></li><li><a href=../schemas/>Schemas</a></li></ul></div><li><a class="chevron-toggle collapsed" data-toggle=collapse data-parent=full href=#Spark><span>Spark</span>
<i class="fa fa-chevron-right"></i>
<i class="fa fa-chevron-down"></i></a></li><div id=Spark class=collapse><ul class=sub-menu><li><a href=../spark-ddl/>DDL</a></li><li><a href=../getting-started/>Getting Started</a></li><li><a href=../spark-procedures/>Procedures</a></li><li><a href=../spark-queries/>Queries</a></li><li><a href=../spark-structured-streaming/>Structured Streaming</a></li><li><a href=../spark-writes/>Writes</a></li></ul></div><li><a class="chevron-toggle collapsed" data-toggle=collapse data-parent=full href=#Flink><span>Flink</span>
<i class="fa fa-chevron-right"></i>
<i class="fa fa-chevron-down"></i></a></li><div id=Flink class=collapse><ul class=sub-menu><li><a href=../flink/>Enabling Iceberg in Flink</a></li><li><a href=../flink-connector/>Flink Connector</a></li></ul></div><li><a id=active href=../hive/><span>Hive</span></a></li><li><a target=_blank href=https://trino.io/docs/current/connector/iceberg.html><span>Trino</span></a></li><li><a target=_blank href=https://prestodb.io/docs/current/connector/iceberg.html><span>Presto</span></a></li><li><a target=_blank href=https://docs.dremio.com/data-formats/apache-iceberg/><span>Dremio</span></a></li><li><a target=_blank href=https://docs.starrocks.com/en-us/main/using_starrocks/External_table#apache-iceberg-external-table><span>StarRocks</span></a></li><li><a target=_blank href=https://docs.aws.amazon.com/athena/latest/ug/querying-iceberg.html><span>Amazon Athena</span></a></li><li><a target=_blank href=https://docs.aws.amazon.com/emr/latest/ReleaseGuide/emr-iceberg-create-cluster.html><span>Amazon EMR</span></a></li><li><a target=_blank href=https://impala.apache.org/docs/build/html/topics/impala_iceberg.html><span>Impala</span></a></li><li><a target=_blank href=https://doris.apache.org/docs/ecosystem/external-table/iceberg-of-doris.html><span>Doris</span></a></li><li><a class="chevron-toggle collapsed" data-toggle=collapse data-parent=full href=#Integrations><span>Integrations</span>
<i class="fa fa-chevron-right"></i>
<i class="fa fa-chevron-down"></i></a></li><div id=Integrations class=collapse><ul class=sub-menu><li><a href=../aws/>AWS</a></li><li><a href=../jdbc/>JDBC</a></li><li><a href=../nessie/>Nessie</a></li></ul></div><li><a class="chevron-toggle collapsed" data-toggle=collapse data-parent=full href=#API><span>API</span>
<i class="fa fa-chevron-right"></i>
<i class="fa fa-chevron-down"></i></a></li><div id=API class=collapse><ul class=sub-menu><li><a href=../java-api-quickstart/>Java Quickstart</a></li><li><a href=../api/>Java API</a></li><li><a href=../custom-catalog/>Java Custom Catalog</a></li><li><a href=../python-quickstart/>Python Quickstart</a></li><li><a href=../python-api-intro/>Python API</a></li><li><a href=../python-feature-support/>Python Feature Support</a></li></ul></div><li><a href=https://iceberg.apache.org/docs/0.13.2/../../javadoc/latest><span>Javadoc</span></a></li></div></div><div id=content class=markdown-body><div class=margin-for-toc><h1 id=hive>Hive</h1><p>Iceberg supports reading and writing Iceberg tables through <a href=https://hive.apache.org>Hive</a> by using a <a href=https://cwiki.apache.org/confluence/display/Hive/StorageHandlers>StorageHandler</a>.
Here is the current compatibility matrix for Iceberg Hive support:</p><table><thead><tr><th>Feature</th><th>Hive 2.x</th><th>Hive 3.1.2</th></tr></thead><tbody><tr><td>CREATE EXTERNAL TABLE</td><td>‚úîÔ∏è</td><td>‚úîÔ∏è</td></tr><tr><td>CREATE TABLE</td><td>‚úîÔ∏è</td><td>‚úîÔ∏è</td></tr><tr><td>DROP TABLE</td><td>‚úîÔ∏è</td><td>‚úîÔ∏è</td></tr><tr><td>SELECT</td><td>‚úîÔ∏è (MapReduce and Tez)</td><td>‚úîÔ∏è (MapReduce and Tez)</td></tr><tr><td>INSERT INTO</td><td>‚úîÔ∏è (MapReduce only)Ô∏è</td><td>‚úîÔ∏è (MapReduce only)</td></tr></tbody></table><h2 id=enabling-iceberg-support-in-hive>Enabling Iceberg support in Hive</h2><h3 id=loading-runtime-jar>Loading runtime jar</h3><p>To enable Iceberg support in Hive, the <code>HiveIcebergStorageHandler</code> and supporting classes need to be made available on Hive&rsquo;s classpath.
These are provided by the <code>iceberg-hive-runtime</code> jar file.
For example, if using the Hive shell, this can be achieved by issuing a statement like so:</p><pre tabindex=0><code>add jar /path/to/iceberg-hive-runtime.jar;
</code></pre><p>There are many others ways to achieve this including adding the jar file to Hive&rsquo;s auxiliary classpath so it is available by default.
Please refer to Hive&rsquo;s documentation for more information.</p><h3 id=enabling-support>Enabling support</h3><p>If the Iceberg storage handler is not in Hive&rsquo;s classpath, then Hive cannot load or update the metadata for an Iceberg table when the storage handler is set.
To avoid the appearance of broken tables in Hive, Iceberg will not add the storage handler to a table unless Hive support is enabled.
The storage handler is kept in sync (added or removed) every time Hive engine support for the table is updated, i.e. turned on or off in the table properties.
There are two ways to enable Hive support: globally in Hadoop Configuration and per-table using a table property.</p><h4 id=hadoop-configuration>Hadoop configuration</h4><p>To enable Hive support globally for an application, set <code>iceberg.engine.hive.enabled=true</code> in its Hadoop configuration.
For example, setting this in the <code>hive-site.xml</code> loaded by Spark will enable the storage handler for all tables created by Spark.</p><div class=danger>Starting with Apache Iceberg <code>0.11.0</code>, when using Hive with Tez you also have to disable vectorization (<code>hive.vectorized.execution.enabled=false</code>).</div><h4 id=table-property-configuration>Table property configuration</h4><p>Alternatively, the property <code>engine.hive.enabled</code> can be set to <code>true</code> and added to the table properties when creating the Iceberg table.
Here is an example of doing it programmatically:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>Catalog catalog <span style=color:#f92672>=</span> <span style=color:#f92672>...;</span>
</span></span><span style=display:flex><span>Map<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>,</span> String<span style=color:#f92672>&gt;</span> tableProperties <span style=color:#f92672>=</span> Maps<span style=color:#f92672>.</span><span style=color:#a6e22e>newHashMap</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>tableProperties<span style=color:#f92672>.</span><span style=color:#a6e22e>put</span><span style=color:#f92672>(</span>TableProperties<span style=color:#f92672>.</span><span style=color:#a6e22e>ENGINE_HIVE_ENABLED</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;true&#34;</span><span style=color:#f92672>);</span> <span style=color:#75715e>// engine.hive.enabled=true
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>catalog<span style=color:#f92672>.</span><span style=color:#a6e22e>createTable</span><span style=color:#f92672>(</span>tableId<span style=color:#f92672>,</span> schema<span style=color:#f92672>,</span> spec<span style=color:#f92672>,</span> tableProperties<span style=color:#f92672>);</span>
</span></span></code></pre></div><p>The table level configuration overrides the global Hadoop configuration.</p><h4 id=hive-on-tez-configuration>Hive on Tez configuration</h4><p>To use the Tez engine on Hive <code>3.1.2</code> or later, Tez needs to be upgraded to >= <code>0.10.1</code> which contains a necessary fix <a href=https://issues.apache.org/jira/browse/TEZ-4248>Tez-4248</a>.</p><p>To use the Tez engine on Hive <code>2.3.x</code>, you will need to manually build Tez from the <code>branch-0.9</code> branch due to a backwards incompatibility issue with Tez <code>0.10.1</code>.</p><p>You will also need to set the following property in the Hive configuration: <code>tez.mrreader.config.update.properties=hive.io.file.readcolumn.names,hive.io.file.readcolumn.ids</code>.</p><h2 id=catalog-management>Catalog Management</h2><h3 id=global-hive-catalog>Global Hive catalog</h3><p>From the Hive engine&rsquo;s perspective, there is only one global data catalog that is defined in the Hadoop configuration in the runtime environment.
In contrast, Iceberg supports multiple different data catalog types such as Hive, Hadoop, AWS Glue, or custom catalog implementations.
Iceberg also allows loading a table directly based on its path in the file system. Those tables do not belong to any catalog.
Users might want to read these cross-catalog and path-based tables through the Hive engine for use cases like join.</p><p>To support this, a table in the Hive metastore can represent three different ways of loading an Iceberg table,
depending on the table&rsquo;s <code>iceberg.catalog</code> property:</p><ol><li>The table will be loaded using a <code>HiveCatalog</code> that corresponds to the metastore configured in the Hive environment if no <code>iceberg.catalog</code> is set</li><li>The table will be loaded using a custom catalog if <code>iceberg.catalog</code> is set to a catalog name (see below)</li><li>The table can be loaded directly using the table&rsquo;s root location if <code>iceberg.catalog</code> is set to <code>location_based_table</code></li></ol><p>For cases 2 and 3 above, users can create an overlay of an Iceberg table in the Hive metastore,
so that different table types can work together in the same Hive environment.
See <a href=#create-external-table>CREATE EXTERNAL TABLE</a> and <a href=#create-table>CREATE TABLE</a> for more details.</p><h3 id=custom-iceberg-catalogs>Custom Iceberg catalogs</h3><p>To globally register different catalogs, set the following Hadoop configurations:</p><table><thead><tr><th>Config Key</th><th>Description</th></tr></thead><tbody><tr><td>iceberg.catalog.&lt;catalog_name>.type</td><td>type of catalog: <code>hive</code>, <code>hadoop</code>, or left unset if using a custom catalog</td></tr><tr><td>iceberg.catalog.&lt;catalog_name>.catalog-impl</td><td>catalog implementation, must not be null if type is empty</td></tr><tr><td>iceberg.catalog.&lt;catalog_name>.&lt;key></td><td>any config key and value pairs for the catalog</td></tr></tbody></table><p>Here are some examples using Hive CLI:</p><p>Register a <code>HiveCatalog</code> called <code>another_hive</code>:</p><pre tabindex=0><code>SET iceberg.catalog.another_hive.type=hive;
SET iceberg.catalog.another_hive.uri=thrift://example.com:9083;
SET iceberg.catalog.another_hive.clients=10;
SET iceberg.catalog.another_hive.warehouse=hdfs://example.com:8020/warehouse;
</code></pre><p>Register a <code>HadoopCatalog</code> called <code>hadoop</code>:</p><pre tabindex=0><code>SET iceberg.catalog.hadoop.type=hadoop;
SET iceberg.catalog.hadoop.warehouse=hdfs://example.com:8020/warehouse;
</code></pre><p>Register an AWS <code>GlueCatalog</code> called <code>glue</code>:</p><pre tabindex=0><code>SET iceberg.catalog.glue.catalog-impl=org.apache.iceberg.aws.GlueCatalog;
SET iceberg.catalog.glue.warehouse=s3://my-bucket/my/key/prefix;
SET iceberg.catalog.glue.lock-impl=org.apache.iceberg.aws.glue.DynamoLockManager;
SET iceberg.catalog.glue.lock.table=myGlueLockTable;
</code></pre><h2 id=ddl-commands>DDL Commands</h2><h3 id=create-external-table>CREATE EXTERNAL TABLE</h3><p>The <code>CREATE EXTERNAL TABLE</code> command is used to overlay a Hive table &ldquo;on top of&rdquo; an existing Iceberg table.
Iceberg tables are created using either a <a href=../../../javadoc/0.13.2/index.html?org/apache/iceberg/catalog/Catalog.html><code>Catalog</code></a>,
or an implementation of the <a href=../../../javadoc/0.13.2/index.html?org/apache/iceberg/Tables.html><code>Tables</code></a> interface,
and Hive needs to be configured accordingly to operate on these different types of table.</p><h4 id=hive-catalog-tables>Hive catalog tables</h4><p>As described before, tables created by the <code>HiveCatalog</code> with Hive engine feature enabled are directly visible by the Hive engine, so there is no need to create an overlay.</p><h4 id=custom-catalog-tables>Custom catalog tables</h4><p>For a table in a registered catalog, specify the catalog name in the statement using table property <code>iceberg.catalog</code>.
For example, the SQL below creates an overlay for a table in a <code>hadoop</code> type catalog named <code>hadoop_cat</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>SET</span> iceberg.<span style=color:#66d9ef>catalog</span>.hadoop_cat.<span style=color:#66d9ef>type</span><span style=color:#f92672>=</span>hadoop;
</span></span><span style=display:flex><span><span style=color:#66d9ef>SET</span> iceberg.<span style=color:#66d9ef>catalog</span>.hadoop_cat.warehouse<span style=color:#f92672>=</span>hdfs:<span style=color:#f92672>//</span>example.com:<span style=color:#ae81ff>8020</span><span style=color:#f92672>/</span>hadoop_cat;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>EXTERNAL</span> <span style=color:#66d9ef>TABLE</span> database_a.table_a
</span></span><span style=display:flex><span>STORED <span style=color:#66d9ef>BY</span> <span style=color:#e6db74>&#39;org.apache.iceberg.mr.hive.HiveIcebergStorageHandler&#39;</span>
</span></span><span style=display:flex><span>TBLPROPERTIES (<span style=color:#e6db74>&#39;iceberg.catalog&#39;</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#39;hadoop_cat&#39;</span>);
</span></span></code></pre></div><p>When <code>iceberg.catalog</code> is missing from both table properties and the global Hadoop configuration, <code>HiveCatalog</code> will be used as default.</p><h4 id=path-based-hadoop-tables>Path-based Hadoop tables</h4><p>Iceberg tables created using <code>HadoopTables</code> are stored entirely in a directory in a filesystem like HDFS.
These tables are considered to have no catalog.
To indicate that, set <code>iceberg.catalog</code> property to <code>location_based_table</code>. For example:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>EXTERNAL</span> <span style=color:#66d9ef>TABLE</span> table_a 
</span></span><span style=display:flex><span>STORED <span style=color:#66d9ef>BY</span> <span style=color:#e6db74>&#39;org.apache.iceberg.mr.hive.HiveIcebergStorageHandler&#39;</span> 
</span></span><span style=display:flex><span><span style=color:#66d9ef>LOCATION</span> <span style=color:#e6db74>&#39;hdfs://some_bucket/some_path/table_a&#39;</span>
</span></span><span style=display:flex><span>TBLPROPERTIES (<span style=color:#e6db74>&#39;iceberg.catalog&#39;</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#39;location_based_table&#39;</span>);
</span></span></code></pre></div><h3 id=create-table>CREATE TABLE</h3><p>Hive also supports directly creating a new Iceberg table through <code>CREATE TABLE</code> statement. For example:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TABLE</span> database_a.table_a (
</span></span><span style=display:flex><span>  id bigint, name string
</span></span><span style=display:flex><span>) PARTITIONED <span style=color:#66d9ef>BY</span> (
</span></span><span style=display:flex><span>  dept string
</span></span><span style=display:flex><span>) STORED <span style=color:#66d9ef>BY</span> <span style=color:#e6db74>&#39;org.apache.iceberg.mr.hive.HiveIcebergStorageHandler&#39;</span>;
</span></span></code></pre></div><div class=info>to Hive, the table appears to be unpartitioned although the underlying Iceberg table is partitioned.</div><div class=info>Due to the limitation of Hive <code>PARTITIONED BY</code> syntax, if you use Hive <code>CREATE TABLE</code>,
currently you can only partition by columns, which is translated to Iceberg identity partition transform.
You cannot partition by other Iceberg partition transforms such as <code>days(timestamp)</code>.
To create table with all partition transforms, you need to create the table with other engines like Spark or Flink.</div><h4 id=custom-catalog-table>Custom catalog table</h4><p>You can also create a new table that is managed by a custom catalog.
For example, the following code creates a table in a custom Hadoop catalog:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>SET</span> iceberg.<span style=color:#66d9ef>catalog</span>.hadoop_cat.<span style=color:#66d9ef>type</span><span style=color:#f92672>=</span>hadoop;
</span></span><span style=display:flex><span><span style=color:#66d9ef>SET</span> iceberg.<span style=color:#66d9ef>catalog</span>.hadoop_cat.warehouse<span style=color:#f92672>=</span>hdfs:<span style=color:#f92672>//</span>example.com:<span style=color:#ae81ff>8020</span><span style=color:#f92672>/</span>hadoop_cat;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TABLE</span> database_a.table_a (
</span></span><span style=display:flex><span>  id bigint, name string
</span></span><span style=display:flex><span>) PARTITIONED <span style=color:#66d9ef>BY</span> (
</span></span><span style=display:flex><span>  dept string
</span></span><span style=display:flex><span>) STORED <span style=color:#66d9ef>BY</span> <span style=color:#e6db74>&#39;org.apache.iceberg.mr.hive.HiveIcebergStorageHandler&#39;</span>
</span></span><span style=display:flex><span>TBLPROPERTIES (<span style=color:#e6db74>&#39;iceberg.catalog&#39;</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#39;hadoop_cat&#39;</span>);
</span></span></code></pre></div><div class=danger>If the table to create already exists in the custom catalog, this will create a managed overlay table.
This means technically you can omit the <code>EXTERNAL</code> keyword when creating an overlay table.
However, this is <strong>not recommended</strong> because creating managed overlay tables could pose a risk
to the shared data files in case of accidental drop table commands from the Hive side,
which would unintentionally remove all the data in the table.</div><h3 id=drop-table>DROP TABLE</h3><p>Tables can be dropped using the <code>DROP TABLE</code> command:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>DROP</span> <span style=color:#66d9ef>TABLE</span> [<span style=color:#66d9ef>IF</span> <span style=color:#66d9ef>EXISTS</span>] <span style=color:#66d9ef>table_name</span> [PURGE];
</span></span></code></pre></div><p>You can configure purge behavior through global Hadoop configuration or Hive metastore table properties:</p><table><thead><tr><th>Config key</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td>external.table.purge</td><td>true</td><td>if all data and metadata should be purged in a table by default</td></tr></tbody></table><p>Each Iceberg table&rsquo;s default purge behavior can also be configured through Iceberg table properties:</p><table><thead><tr><th>Property</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td>gc.enabled</td><td>true</td><td>if all data and metadata should be purged in the table by default</td></tr></tbody></table><p>When changing <code>gc.enabled</code> on the Iceberg table via <code>UpdateProperties</code>, <code>external.table.purge</code> is also updated on HMS table accordingly.
When setting <code>external.table.purge</code> as a table prop during Hive <code>CREATE TABLE</code>, <code>gc.enabled</code> is pushed down accordingly to the Iceberg table properties.
This makes sure that the 2 properties are always consistent at table level between Hive and Iceberg.</p><div class=danger>Changing <code>external.table.purge</code> via Hive <code>ALTER TABLE SET TBLPROPERTIES</code> does not update <code>gc.enabled</code> on the Iceberg table.
This is a limitation on Hive 3.1.2 because the <code>HiveMetaHook</code> doesn&rsquo;t have all the hooks for alter tables yet.</div><h2 id=querying-with-sql>Querying with SQL</h2><p>Here are the features highlights for Iceberg Hive read support:</p><ol><li><strong>Predicate pushdown</strong>: Pushdown of the Hive SQL <code>WHERE</code> clause has been implemented so that these filters are used at the Iceberg <code>TableScan</code> level as well as by the Parquet and ORC Readers.</li><li><strong>Column projection</strong>: Columns from the Hive SQL <code>SELECT</code> clause are projected down to the Iceberg readers to reduce the number of columns read.</li><li><strong>Hive query engines</strong>: Both the MapReduce and Tez query execution engines are supported.</li></ol><h3 id=configurations>Configurations</h3><p>Here are the Hadoop configurations that one can adjust for the Hive reader:</p><table><thead><tr><th>Config key</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td>iceberg.mr.reuse.containers</td><td>false</td><td>if Avro reader should reuse containers</td></tr><tr><td>iceberg.mr.case.sensitive</td><td>true</td><td>if the query is case-sensitive</td></tr></tbody></table><h3 id=select>SELECT</h3><p>You should now be able to issue Hive SQL <code>SELECT</code> queries and see the results returned from the underlying Iceberg table, for example:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>from</span> table_a;
</span></span></code></pre></div><h2 id=writing-with-sql>Writing with SQL</h2><h3 id=configurations-1>Configurations</h3><p>Here are the Hadoop configurations that one can adjust for the Hive writer:</p><table><thead><tr><th>Config key</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td>iceberg.mr.commit.table.thread.pool.size</td><td>10</td><td>the number of threads of a shared thread pool to execute parallel commits for output tables</td></tr><tr><td>iceberg.mr.commit.file.thread.pool.size</td><td>10</td><td>the number of threads of a shared thread pool to execute parallel commits for files in each output table</td></tr></tbody></table><h3 id=insert-into>INSERT INTO</h3><p>Hive supports the standard single-table <code>INSERT INTO</code> operation:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> table_a <span style=color:#66d9ef>VALUES</span> (<span style=color:#e6db74>&#39;a&#39;</span>, <span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> table_a <span style=color:#66d9ef>SELECT</span> ...;
</span></span></code></pre></div><p>Multi-table insert is also supported, but it will not be atomic and are committed one table at a time. Partial changes will be visible during the commit process and failures can leave partial changes committed. Changes within a single table will remain atomic.</p><p>Here is an example of inserting into multiple tables at once in Hive SQL:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>FROM</span> customers
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> target1 <span style=color:#66d9ef>SELECT</span> customer_id, first_name
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> target2 <span style=color:#66d9ef>SELECT</span> last_name, customer_id;
</span></span></code></pre></div><h2 id=type-compatibility>Type compatibility</h2><p>Hive and Iceberg support different set of types. Iceberg can perform type conversion automatically, but not for all combinations,
so you may want to understand the type conversion in Iceberg in prior to design the types of columns in your tables.
You can enable auto-conversion through Hadoop configuration (not enabled by default):</p><table><thead><tr><th>Config key</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td>iceberg.mr.schema.auto.conversion</td><td>false</td><td>if Hive should perform type auto-conversion</td></tr></tbody></table><h3 id=hive-type-to-iceberg-type>Hive type to Iceberg type</h3><p>This type conversion table describes how Hive types are converted to the Iceberg types.
The conversion applies on both creating Iceberg table and writing to Iceberg table via Hive.</p><table><thead><tr><th>Hive</th><th>Iceberg</th><th>Notes</th></tr></thead><tbody><tr><td>boolean</td><td>boolean</td><td></td></tr><tr><td>short</td><td>integer</td><td>auto-conversion</td></tr><tr><td>byte</td><td>integer</td><td>auto-conversion</td></tr><tr><td>integer</td><td>integer</td><td></td></tr><tr><td>long</td><td>long</td><td></td></tr><tr><td>float</td><td>float</td><td></td></tr><tr><td>double</td><td>double</td><td></td></tr><tr><td>date</td><td>date</td><td></td></tr><tr><td>timestamp</td><td>timestamp without timezone</td><td></td></tr><tr><td>timestamplocaltz</td><td>timestamp with timezone</td><td>Hive 3 only</td></tr><tr><td>interval_year_month</td><td></td><td>not supported</td></tr><tr><td>interval_day_time</td><td></td><td>not supported</td></tr><tr><td>char</td><td>string</td><td>auto-conversion</td></tr><tr><td>varchar</td><td>string</td><td>auto-conversion</td></tr><tr><td>string</td><td>string</td><td></td></tr><tr><td>binary</td><td>binary</td><td></td></tr><tr><td>decimal</td><td>decimal</td><td></td></tr><tr><td>struct</td><td>struct</td><td></td></tr><tr><td>list</td><td>list</td><td></td></tr><tr><td>map</td><td>map</td><td></td></tr><tr><td>union</td><td></td><td>not supported</td></tr></tbody></table></div><div id=toc class=markdown-body><div id=full><nav id=TableOfContents><ul><li><a href=#enabling-iceberg-support-in-hive>Enabling Iceberg support in Hive</a><ul><li><a href=#loading-runtime-jar>Loading runtime jar</a></li><li><a href=#enabling-support>Enabling support</a></li></ul></li><li><a href=#catalog-management>Catalog Management</a><ul><li><a href=#global-hive-catalog>Global Hive catalog</a></li><li><a href=#custom-iceberg-catalogs>Custom Iceberg catalogs</a></li></ul></li><li><a href=#ddl-commands>DDL Commands</a><ul><li><a href=#create-external-table>CREATE EXTERNAL TABLE</a></li><li><a href=#create-table>CREATE TABLE</a></li><li><a href=#drop-table>DROP TABLE</a></li></ul></li><li><a href=#querying-with-sql>Querying with SQL</a><ul><li><a href=#configurations>Configurations</a></li><li><a href=#select>SELECT</a></li></ul></li><li><a href=#writing-with-sql>Writing with SQL</a><ul><li><a href=#configurations-1>Configurations</a></li><li><a href=#insert-into>INSERT INTO</a></li></ul></li><li><a href=#type-compatibility>Type compatibility</a><ul><li><a href=#hive-type-to-iceberg-type>Hive type to Iceberg type</a></li></ul></li></ul></nav></div></div></div></div></section></body><script src=https://iceberg.apache.org/docs/0.13.2//js/jquery-1.11.0.js></script>
<script src=https://iceberg.apache.org/docs/0.13.2//js/jquery.easing.min.js></script>
<script type=text/javascript src=https://iceberg.apache.org/docs/0.13.2//js/search.js></script>
<script src=https://iceberg.apache.org/docs/0.13.2//js/bootstrap.min.js></script>
<script src=https://iceberg.apache.org/docs/0.13.2//js/iceberg-theme.js></script></html>