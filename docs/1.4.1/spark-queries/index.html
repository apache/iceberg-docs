<!doctype html><html><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=author content><title>Queries</title>
<link href=../css/bootstrap.css rel=stylesheet><link href=../css/markdown.css rel=stylesheet><link href=../css/katex.min.css rel=stylesheet><link href=../css/iceberg-theme.css rel=stylesheet><link href=../font-awesome-4.7.0/css/font-awesome.min.css rel=stylesheet type=text/css><link href="//fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic,700italic" rel=stylesheet type=text/css><link href=../css/termynal.css rel=stylesheet></head><body><head><script>function addAnchor(e){e.insertAdjacentHTML("beforeend",`<a href="#${e.id}" class="anchortag" ariaLabel="Anchor"> ðŸ”— </a>`)}document.addEventListener("DOMContentLoaded",function(){var e=document.querySelectorAll("h1[id], h2[id], h3[id], h4[id]");e&&e.forEach(addAnchor)})</script></head><nav class="navbar navbar-default" role=navigation><topsection><div class=navbar-fixed-top><div><button type=button class=navbar-toggle data-toggle=collapse data-target=div.sidebar>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span>
</button>
<a class="page-scroll navbar-brand" href=https://iceberg.apache.org/><img class=top-navbar-logo src=https://iceberg.apache.org/docs/1.4.1//img/iceberg-logo-icon.png> Apache Iceberg</a></div><div><input type=search class=form-control id=search-input placeholder=Search... maxlength=64 data-hotkeys=s/></div><div class=versions-dropdown><span>1.4.1</span> <i class="fa fa-chevron-down"></i><div class=versions-dropdown-content><ul><li class=versions-dropdown-selection><a href=https://iceberg.apache.org/docs/1.4.1/../latest>latest</a></li><li class=versions-dropdown-selection><a href=https://iceberg.apache.org/docs/1.4.1/../1.4.1>1.4.1</a></li><li class=versions-dropdown-selection><a href=https://iceberg.apache.org/docs/1.4.1/../1.4.0>1.4.0</a></li><li class=versions-dropdown-selection><a href=https://iceberg.apache.org/docs/1.4.1/../1.3.1>1.3.1</a></li><li class=versions-dropdown-selection><a href=https://iceberg.apache.org/docs/1.4.1/../1.3.0>1.3.0</a></li><li class=versions-dropdown-selection><a href=https://iceberg.apache.org/docs/1.4.1/../1.2.1>1.2.1</a></li><li class=versions-dropdown-selection><a href=https://iceberg.apache.org/docs/1.4.1/../1.2.0>1.2.0</a></li><li class=versions-dropdown-selection><a href=https://iceberg.apache.org/docs/1.4.1/../1.1.0>1.1.0</a></li><li class=versions-dropdown-selection><a href=https://iceberg.apache.org/docs/1.4.1/../1.0.0>1.0.0</a></li><li class=versions-dropdown-selection><a href=https://iceberg.apache.org/docs/1.4.1/../0.14.1>0.14.1</a></li><li class=versions-dropdown-selection><a href=https://iceberg.apache.org/docs/1.4.1/../0.14.0>0.14.0</a></li><li class=versions-dropdown-selection><a href=https://iceberg.apache.org/docs/1.4.1/../0.13.2>0.13.2</a></li><li class=versions-dropdown-selection><a href=https://iceberg.apache.org/docs/1.4.1/../0.13.1>0.13.1</a></li><li class=versions-dropdown-selection><a href=https://iceberg.apache.org/docs/1.4.1/../0.13.0>0.13.0</a></li><li class=versions-dropdown-selection><a href=https://iceberg.apache.org/docs/1.4.1/../0.12.1>0.12.1</a></li></ul></div></div></div><div class="navbar-menu-fixed-top navbar-pages-group"><div class=versions-dropdown><div class=topnav-page-selection><a href>Quickstart</a> <i class="fa fa-chevron-down"></i></div class="topnav-page-selection"><div class=versions-dropdown-content><ul><li class=topnav-page-selection><a href=https://iceberg.apache.org/docs/1.4.1/../../hive-quickstart>Hive</a></li class="topnav-page-selection"><li class=topnav-page-selection><a href=https://iceberg.apache.org/docs/1.4.1/../../spark-quickstart>Spark</a></li class="topnav-page-selection"></ul></div></div><div class=topnav-page-selection><a id=active href=https://iceberg.apache.org/docs/1.4.1/../../docs/latest>Docs</a></div><div class=topnav-page-selection><a href=https://iceberg.apache.org/docs/1.4.1/../../releases>Releases</a></div class="topnav-page-selection"><div class=topnav-page-selection><a href=https://iceberg.apache.org/docs/1.4.1/../../roadmap>Roadmap</a></div class="topnav-page-selection"><div class=topnav-page-selection><a href=https://iceberg.apache.org/docs/1.4.1/../../blogs>Blogs</a></div class="topnav-page-selection"><div class=topnav-page-selection><a href=https://iceberg.apache.org/docs/1.4.1/../../talks>Talks</a></div class="topnav-page-selection"><div class=versions-dropdown><div class=topnav-page-selection><a href>Project</a> <i class="fa fa-chevron-down"></i></div class="topnav-page-selection"><div class=versions-dropdown-content><ul><li class=topnav-page-selection><a href=https://iceberg.apache.org/docs/1.4.1/../../community>Community</a></li class="topnav-page-selection"><li class=topnav-page-selection><a href=https://iceberg.apache.org/docs/1.4.1/../../spec>Spec</a></li class="topnav-page-selection"><li class=topnav-page-selection><a href=https://iceberg.apache.org/docs/1.4.1/../../view-spec>View Spec</a></li class="topnav-page-selection"><li class=topnav-page-selection><a href=https://iceberg.apache.org/docs/1.4.1/../../puffin-spec>Puffin Spec</a></li class="topnav-page-selection"><li class=topnav-page-selection><a href=https://iceberg.apache.org/docs/1.4.1/../../multi-engine-support>Multi-Engine Support</a></li class="topnav-page-selection"><li class=topnav-page-selection><a href=https://iceberg.apache.org/docs/1.4.1/../../how-to-release>How To Release</a></li class="topnav-page-selection"><li class=topnav-page-selection><a href=https://iceberg.apache.org/docs/1.4.1/../../terms>Terms</a></li class="topnav-page-selection"></ul></div></div><div class=versions-dropdown><div class=topnav-page-selection><a href>ASF</a> <i class="fa fa-chevron-down"></i></div class="topnav-page-selection"><div class=versions-dropdown-content><ul><li class=topnav-page-selection><a target=_blank href=https://www.apache.org/foundation/sponsorship.html>Donate</a></li class="topnav-page-selection"><li class=topnav-page-selection><a target=_blank href=https://www.apache.org/events/current-event.html>Events</a></li class="topnav-page-selection"><li class=topnav-page-selection><a target=_blank href=https://www.apache.org/licenses/>License</a></li class="topnav-page-selection"><li class=topnav-page-selection><a target=_blank href=https://www.apache.org/security/>Security</a></li class="topnav-page-selection"><li class=topnav-page-selection><a target=_blank href=https://www.apache.org/foundation/thanks.html>Sponsors</a></li class="topnav-page-selection"></ul></div></div><div class=topnav-page-selection><a href=https://github.com/apache/iceberg target=_blank><img src=https://iceberg.apache.org/docs/1.4.1//img/GitHub-Mark.png target=_blank class=top-navbar-logo></a></div><div class=topnav-page-selection><a href=https://join.slack.com/t/apache-iceberg/shared_invite/zt-1znkcg5zm-7_FE~pcox347XwZE3GNfPg target=_blank><img src=https://iceberg.apache.org/docs/1.4.1//img/Slack_Mark_Web.png target=_blank class=top-navbar-logo></a></div></div></topsection></nav><section><div id=search-results-container><ul id=search-results></ul></div></section><body dir=ltr><section><div class="grid-container leftnav-and-toc"><div class="sidebar markdown-body"><div id=full><ul><li><a href=../><span>Introduction</span></a></li><li><a class="chevron-toggle collapsed" data-toggle=collapse data-parent=full href=#Tables><span>Tables</span>
<i class="fa fa-chevron-right"></i>
<i class="fa fa-chevron-down"></i></a></li><div id=Tables class=collapse><ul class=sub-menu><li><a href=../branching/>Branching and Tagging</a></li><li><a href=../configuration/>Configuration</a></li><li><a href=../evolution/>Evolution</a></li><li><a href=../maintenance/>Maintenance</a></li><li><a href=../metrics-reporting/>Metrics Reporting</a></li><li><a href=../partitioning/>Partitioning</a></li><li><a href=../performance/>Performance</a></li><li><a href=../reliability/>Reliability</a></li><li><a href=../schemas/>Schemas</a></li></ul></div><li><a class=chevron-toggle data-toggle=collapse data-parent=full href=#Spark><span>Spark</span>
<i class="fa fa-chevron-right"></i>
<i class="fa fa-chevron-down"></i></a></li><div id=Spark class="collapse in"><ul class=sub-menu><li><a href=../getting-started/>Getting Started</a></li><li><a href=../spark-configuration/>Configuration</a></li><li><a href=../spark-ddl/>DDL</a></li><li><a href=../spark-procedures/>Procedures</a></li><li><a id=active href=../spark-queries/>Queries</a></li><li><a href=../spark-structured-streaming/>Structured Streaming</a></li><li><a href=../spark-writes/>Writes</a></li></ul></div><li><a class="chevron-toggle collapsed" data-toggle=collapse data-parent=full href=#Flink><span>Flink</span>
<i class="fa fa-chevron-right"></i>
<i class="fa fa-chevron-down"></i></a></li><div id=Flink class=collapse><ul class=sub-menu><li><a href=../flink/>Flink Getting Started</a></li><li><a href=../flink-connector/>Flink Connector</a></li><li><a href=../flink-ddl/>Flink DDL</a></li><li><a href=../flink-queries/>Flink Queries</a></li><li><a href=../flink-writes/>Flink Writes</a></li><li><a href=../flink-actions/>Flink Actions</a></li><li><a href=../flink-configuration/>Flink Configuration</a></li></ul></div><li><a href=../hive/><span>Hive</span></a></li><li><a target=_blank href=https://trino.io/docs/current/connector/iceberg.html><span>Trino</span></a></li><li><a target=_blank href=https://clickhouse.com/docs/en/engines/table-engines/integrations/iceberg><span>ClickHouse</span></a></li><li><a target=_blank href=https://prestodb.io/docs/current/connector/iceberg.html><span>Presto</span></a></li><li><a target=_blank href=https://docs.dremio.com/data-formats/apache-iceberg/><span>Dremio</span></a></li><li><a target=_blank href=https://docs.starrocks.io/en-us/latest/data_source/catalog/iceberg_catalog><span>StarRocks</span></a></li><li><a target=_blank href=https://docs.aws.amazon.com/athena/latest/ug/querying-iceberg.html><span>Amazon Athena</span></a></li><li><a target=_blank href=https://docs.aws.amazon.com/emr/latest/ReleaseGuide/emr-iceberg-use-cluster.html><span>Amazon EMR</span></a></li><li><a target=_blank href=https://impala.apache.org/docs/build/html/topics/impala_iceberg.html><span>Impala</span></a></li><li><a target=_blank href=https://doris.apache.org/docs/dev/lakehouse/multi-catalog/iceberg><span>Doris</span></a></li><li><a class="chevron-toggle collapsed" data-toggle=collapse data-parent=full href=#Integrations><span>Integrations</span>
<i class="fa fa-chevron-right"></i>
<i class="fa fa-chevron-down"></i></a></li><div id=Integrations class=collapse><ul class=sub-menu><li><a href=../aws/>AWS</a></li><li><a href=../dell/>Dell</a></li><li><a href=../jdbc/>JDBC</a></li><li><a href=../nessie/>Nessie</a></li></ul></div><li><a class="chevron-toggle collapsed" data-toggle=collapse data-parent=full href=#API><span>API</span>
<i class="fa fa-chevron-right"></i>
<i class="fa fa-chevron-down"></i></a></li><div id=API class=collapse><ul class=sub-menu><li><a href=../java-api-quickstart/>Java Quickstart</a></li><li><a href=../api/>Java API</a></li><li><a href=../custom-catalog/>Java Custom Catalog</a></li></ul></div><li><a class="chevron-toggle collapsed" data-toggle=collapse data-parent=full href=#Migration><span>Migration</span>
<i class="fa fa-chevron-right"></i>
<i class="fa fa-chevron-down"></i></a></li><div id=Migration class=collapse><ul class=sub-menu><li><a href=../table-migration/>Overview</a></li><li><a href=../hive-migration/>Hive Migration</a></li><li><a href=../delta-lake-migration/>Delta Lake Migration</a></li></ul></div><li><a href=https://iceberg.apache.org/docs/1.4.1/../../javadoc/latest><span>Javadoc</span></a></li><li><a target=_blank href=https://py.iceberg.apache.org/><span>PyIceberg</span></a></li></div></div><div id=content class=markdown-body><div class=margin-for-toc><h1 id=spark-queries>Spark Queries</h1><p>To use Iceberg in Spark, first configure <a href=../spark-configuration>Spark catalogs</a>. Iceberg uses Apache Spark&rsquo;s DataSourceV2 API for data source and catalog implementations.</p><h2 id=querying-with-sql>Querying with SQL</h2><p>In Spark 3, tables use identifiers that include a <a href=../spark-configuration#using-catalogs>catalog name</a>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> prod.db.<span style=color:#66d9ef>table</span>; <span style=color:#75715e>-- catalog: prod, namespace: db, table: table
</span></span></span></code></pre></div><p>Metadata tables, like <code>history</code> and <code>snapshots</code>, can use the Iceberg table name as a namespace.</p><p>For example, to read from the <code>files</code> metadata table for <code>prod.db.table</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> prod.db.<span style=color:#66d9ef>table</span>.files;
</span></span></code></pre></div><table><thead><tr><th>content</th><th>file_path</th><th>file_format</th><th>spec_id</th><th>partition</th><th>record_count</th><th>file_size_in_bytes</th><th>column_sizes</th><th>value_counts</th><th>null_value_counts</th><th>nan_value_counts</th><th>lower_bounds</th><th>upper_bounds</th><th>key_metadata</th><th>split_offsets</th><th>equality_ids</th><th>sort_order_id</th></tr></thead><tbody><tr><td>0</td><td>s3:/&mldr;/table/data/00000-3-8d6d60e8-d427-4809-bcf0-f5d45a4aad96.parquet</td><td>PARQUET</td><td>0</td><td>{1999-01-01, 01}</td><td>1</td><td>597</td><td>[1 -> 90, 2 -> 62]</td><td>[1 -> 1, 2 -> 1]</td><td>[1 -> 0, 2 -> 0]</td><td>[]</td><td>[1 -> , 2 -> c]</td><td>[1 -> , 2 -> c]</td><td>null</td><td>[4]</td><td>null</td><td>null</td></tr><tr><td>0</td><td>s3:/&mldr;/table/data/00001-4-8d6d60e8-d427-4809-bcf0-f5d45a4aad96.parquet</td><td>PARQUET</td><td>0</td><td>{1999-01-01, 02}</td><td>1</td><td>597</td><td>[1 -> 90, 2 -> 62]</td><td>[1 -> 1, 2 -> 1]</td><td>[1 -> 0, 2 -> 0]</td><td>[]</td><td>[1 -> , 2 -> b]</td><td>[1 -> , 2 -> b]</td><td>null</td><td>[4]</td><td>null</td><td>null</td></tr><tr><td>0</td><td>s3:/&mldr;/table/data/00002-5-8d6d60e8-d427-4809-bcf0-f5d45a4aad96.parquet</td><td>PARQUET</td><td>0</td><td>{1999-01-01, 03}</td><td>1</td><td>597</td><td>[1 -> 90, 2 -> 62]</td><td>[1 -> 1, 2 -> 1]</td><td>[1 -> 0, 2 -> 0]</td><td>[]</td><td>[1 -> , 2 -> a]</td><td>[1 -> , 2 -> a]</td><td>null</td><td>[4]</td><td>null</td><td>null</td></tr></tbody></table><h2 id=querying-with-dataframes>Querying with DataFrames</h2><p>To load a table as a DataFrame, use <code>table</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#66d9ef>val</span> df <span style=color:#66d9ef>=</span> spark<span style=color:#f92672>.</span>table<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;prod.db.table&#34;</span><span style=color:#f92672>)</span>
</span></span></code></pre></div><h3 id=catalogs-with-dataframereader>Catalogs with DataFrameReader</h3><p>Paths and table names can be loaded with Spark&rsquo;s <code>DataFrameReader</code> interface. How tables are loaded depends on how
the identifier is specified. When using <code>spark.read.format("iceberg").load(table)</code> or <code>spark.table(table)</code> the <code>table</code>
variable can take a number of forms as listed below:</p><ul><li><code>file:///path/to/table</code>: loads a HadoopTable at given path</li><li><code>tablename</code>: loads <code>currentCatalog.currentNamespace.tablename</code></li><li><code>catalog.tablename</code>: loads <code>tablename</code> from the specified catalog.</li><li><code>namespace.tablename</code>: loads <code>namespace.tablename</code> from current catalog</li><li><code>catalog.namespace.tablename</code>: loads <code>namespace.tablename</code> from the specified catalog.</li><li><code>namespace1.namespace2.tablename</code>: loads <code>namespace1.namespace2.tablename</code> from current catalog</li></ul><p>The above list is in order of priority. For example: a matching catalog will take priority over any namespace resolution.</p><h3 id=time-travel>Time travel</h3><h4 id=sql>SQL</h4><p>Spark 3.3 and later supports time travel in SQL queries using <code>TIMESTAMP AS OF</code> or <code>VERSION AS OF</code> clauses.
The <code>VERSION AS OF</code> clause can contain a long snapshot ID or a string branch or tag name.</p><div class=info>Note: If the name of a branch or tag is the same as a snapshot ID, then the snapshot which is selected for time travel is the snapshot
with the given snapshot ID. For example, consider the case where there is a tag named &lsquo;1&rsquo; and it references snapshot with ID 2.
If the version travel clause is <code>VERSION AS OF '1'</code>, time travel will be done to the snapshot with ID 1.
If this is not desired, rename the tag or branch with a well-defined prefix such as &lsquo;snapshot-1&rsquo;.</div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#75715e>-- time travel to October 26, 1986 at 01:21:00
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> prod.db.<span style=color:#66d9ef>table</span> <span style=color:#66d9ef>TIMESTAMP</span> <span style=color:#66d9ef>AS</span> <span style=color:#66d9ef>OF</span> <span style=color:#e6db74>&#39;1986-10-26 01:21:00&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- time travel to snapshot with id 10963874102873L
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> prod.db.<span style=color:#66d9ef>table</span> <span style=color:#66d9ef>VERSION</span> <span style=color:#66d9ef>AS</span> <span style=color:#66d9ef>OF</span> <span style=color:#ae81ff>10963874102873</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- time travel to the head snapshot of audit-branch
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> prod.db.<span style=color:#66d9ef>table</span> <span style=color:#66d9ef>VERSION</span> <span style=color:#66d9ef>AS</span> <span style=color:#66d9ef>OF</span> <span style=color:#e6db74>&#39;audit-branch&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- time travel to the snapshot referenced by the tag historical-snapshot
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> prod.db.<span style=color:#66d9ef>table</span> <span style=color:#66d9ef>VERSION</span> <span style=color:#66d9ef>AS</span> <span style=color:#66d9ef>OF</span> <span style=color:#e6db74>&#39;historical-snapshot&#39;</span>;
</span></span></code></pre></div><p>In addition, <code>FOR SYSTEM_TIME AS OF</code> and <code>FOR SYSTEM_VERSION AS OF</code> clauses are also supported:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> prod.db.<span style=color:#66d9ef>table</span> <span style=color:#66d9ef>FOR</span> SYSTEM_TIME <span style=color:#66d9ef>AS</span> <span style=color:#66d9ef>OF</span> <span style=color:#e6db74>&#39;1986-10-26 01:21:00&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> prod.db.<span style=color:#66d9ef>table</span> <span style=color:#66d9ef>FOR</span> SYSTEM_VERSION <span style=color:#66d9ef>AS</span> <span style=color:#66d9ef>OF</span> <span style=color:#ae81ff>10963874102873</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> prod.db.<span style=color:#66d9ef>table</span> <span style=color:#66d9ef>FOR</span> SYSTEM_VERSION <span style=color:#66d9ef>AS</span> <span style=color:#66d9ef>OF</span> <span style=color:#e6db74>&#39;audit-branch&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> prod.db.<span style=color:#66d9ef>table</span> <span style=color:#66d9ef>FOR</span> SYSTEM_VERSION <span style=color:#66d9ef>AS</span> <span style=color:#66d9ef>OF</span> <span style=color:#e6db74>&#39;historical-snapshot&#39;</span>;
</span></span></code></pre></div><p>Timestamps may also be supplied as a Unix timestamp, in seconds:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#75715e>-- timestamp in seconds
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> prod.db.<span style=color:#66d9ef>table</span> <span style=color:#66d9ef>TIMESTAMP</span> <span style=color:#66d9ef>AS</span> <span style=color:#66d9ef>OF</span> <span style=color:#ae81ff>499162860</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> prod.db.<span style=color:#66d9ef>table</span> <span style=color:#66d9ef>FOR</span> SYSTEM_TIME <span style=color:#66d9ef>AS</span> <span style=color:#66d9ef>OF</span> <span style=color:#ae81ff>499162860</span>;
</span></span></code></pre></div><h4 id=dataframe>DataFrame</h4><p>To select a specific table snapshot or the snapshot at some time in the DataFrame API, Iceberg supports four Spark read options:</p><ul><li><code>snapshot-id</code> selects a specific table snapshot</li><li><code>as-of-timestamp</code> selects the current snapshot at a timestamp, in milliseconds</li><li><code>branch</code> selects the head snapshot of the specified branch. Note that currently branch cannot be combined with as-of-timestamp.</li><li><code>tag</code> selects the snapshot associated with the specified tag. Tags cannot be combined with <code>as-of-timestamp</code>.</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#75715e>// time travel to October 26, 1986 at 01:21:00
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>spark<span style=color:#f92672>.</span>read
</span></span><span style=display:flex><span>    <span style=color:#f92672>.</span>option<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;as-of-timestamp&#34;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;499162860000&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>.</span>format<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;iceberg&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>.</span>load<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;path/to/table&#34;</span><span style=color:#f92672>)</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#75715e>// time travel to snapshot with ID 10963874102873L
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>spark<span style=color:#f92672>.</span>read
</span></span><span style=display:flex><span>    <span style=color:#f92672>.</span>option<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;snapshot-id&#34;</span><span style=color:#f92672>,</span> <span style=color:#ae81ff>10963874102873L</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>.</span>format<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;iceberg&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>.</span>load<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;path/to/table&#34;</span><span style=color:#f92672>)</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#75715e>// time travel to tag historical-snapshot
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>spark<span style=color:#f92672>.</span>read
</span></span><span style=display:flex><span>    <span style=color:#f92672>.</span>option<span style=color:#f92672>(</span><span style=color:#a6e22e>SparkReadOptions</span><span style=color:#f92672>.</span><span style=color:#a6e22e>TAG</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;historical-snapshot&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>.</span>format<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;iceberg&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>.</span>load<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;path/to/table&#34;</span><span style=color:#f92672>)</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#75715e>// time travel to the head snapshot of audit-branch
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>spark<span style=color:#f92672>.</span>read
</span></span><span style=display:flex><span>    <span style=color:#f92672>.</span>option<span style=color:#f92672>(</span><span style=color:#a6e22e>SparkReadOptions</span><span style=color:#f92672>.</span><span style=color:#a6e22e>BRANCH</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;audit-branch&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>.</span>format<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;iceberg&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>.</span>load<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;path/to/table&#34;</span><span style=color:#f92672>)</span>
</span></span></code></pre></div><div class=info>Spark 3.0 and earlier versions do not support using <code>option</code> with <code>table</code> in DataFrameReader commands. All options will be silently
ignored. Do not use <code>table</code> when attempting to time-travel or use other options. See <a href=https://issues.apache.org/jira/browse/SPARK-32592>SPARK-32592</a>.</div><h3 id=incremental-read>Incremental read</h3><p>To read appended data incrementally, use:</p><ul><li><code>start-snapshot-id</code> Start snapshot ID used in incremental scans (exclusive).</li><li><code>end-snapshot-id</code> End snapshot ID used in incremental scans (inclusive). This is optional. Omitting it will default to the current snapshot.</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#75715e>// get the data added after start-snapshot-id (10963874102873L) until end-snapshot-id (63874143573109L)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>spark<span style=color:#f92672>.</span>read<span style=color:#f92672>()</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>.</span>format<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;iceberg&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>.</span>option<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;start-snapshot-id&#34;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;10963874102873&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>.</span>option<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;end-snapshot-id&#34;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;63874143573109&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>.</span>load<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;path/to/table&#34;</span><span style=color:#f92672>)</span>
</span></span></code></pre></div><div class=info>Currently gets only the data from <code>append</code> operation. Cannot support <code>replace</code>, <code>overwrite</code>, <code>delete</code> operations.
Incremental read works with both V1 and V2 format-version.
Incremental read is not supported by Spark&rsquo;s SQL syntax.</div><h2 id=inspecting-tables>Inspecting tables</h2><p>To inspect a table&rsquo;s history, snapshots, and other metadata, Iceberg supports metadata tables.</p><p>Metadata tables are identified by adding the metadata table name after the original table name. For example, history for <code>db.table</code> is read using <code>db.table.history</code>.</p><div class=info>For Spark 3, prior to 3.2, the Spark <a href=../spark-configuration#replacing-the-session-catalog>session catalog</a> does not support table names with multipart identifiers such as <code>catalog.database.table.metadata</code>. As a workaround, configure an <code>org.apache.iceberg.spark.SparkCatalog</code>, or use the Spark <code>DataFrameReader</code> API.</div><h3 id=history>History</h3><p>To show table history:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> prod.db.<span style=color:#66d9ef>table</span>.history;
</span></span></code></pre></div><table><thead><tr><th>made_current_at</th><th>snapshot_id</th><th>parent_id</th><th>is_current_ancestor</th></tr></thead><tbody><tr><td>2019-02-08 03:29:51.215</td><td>5781947118336215154</td><td>NULL</td><td>true</td></tr><tr><td>2019-02-08 03:47:55.948</td><td>5179299526185056830</td><td>5781947118336215154</td><td>true</td></tr><tr><td>2019-02-09 16:24:30.13</td><td>296410040247533544</td><td>5179299526185056830</td><td>false</td></tr><tr><td>2019-02-09 16:32:47.336</td><td>2999875608062437330</td><td>5179299526185056830</td><td>true</td></tr><tr><td>2019-02-09 19:42:03.919</td><td>8924558786060583479</td><td>2999875608062437330</td><td>true</td></tr><tr><td>2019-02-09 19:49:16.343</td><td>6536733823181975045</td><td>8924558786060583479</td><td>true</td></tr></tbody></table><div class=info><strong>This shows a commit that was rolled back.</strong> The example has two snapshots with the same parent, and one is <em>not</em> an ancestor of the current table state.</div><h3 id=metadata-log-entries>Metadata Log Entries</h3><p>To show table metadata log entries:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>from</span> prod.db.<span style=color:#66d9ef>table</span>.metadata_log_entries;
</span></span></code></pre></div><table><thead><tr><th>timestamp</th><th>file</th><th>latest_snapshot_id</th><th>latest_schema_id</th><th>latest_sequence_number</th></tr></thead><tbody><tr><td>2022-07-28 10:43:52.93</td><td>s3://&mldr;/table/metadata/00000-9441e604-b3c2-498a-a45a-6320e8ab9006.metadata.json</td><td>null</td><td>null</td><td>null</td></tr><tr><td>2022-07-28 10:43:57.487</td><td>s3://&mldr;/table/metadata/00001-f30823df-b745-4a0a-b293-7532e0c99986.metadata.json</td><td>170260833677645300</td><td>0</td><td>1</td></tr><tr><td>2022-07-28 10:43:58.25</td><td>s3://&mldr;/table/metadata/00002-2cc2837a-02dc-4687-acc1-b4d86ea486f4.metadata.json</td><td>958906493976709774</td><td>0</td><td>2</td></tr></tbody></table><h3 id=snapshots>Snapshots</h3><p>To show the valid snapshots for a table:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> prod.db.<span style=color:#66d9ef>table</span>.snapshots;
</span></span></code></pre></div><table><thead><tr><th>committed_at</th><th>snapshot_id</th><th>parent_id</th><th>operation</th><th>manifest_list</th><th>summary</th></tr></thead><tbody><tr><td>2019-02-08 03:29:51.215</td><td>57897183625154</td><td>null</td><td>append</td><td>s3://&mldr;/table/metadata/snap-57897183625154-1.avro</td><td>{ added-records -> 2478404, total-records -> 2478404, added-data-files -> 438, total-data-files -> 438, spark.app.id -> application_1520379288616_155055 }</td></tr></tbody></table><p>You can also join snapshots to table history. For example, this query will show table history, with the application ID that wrote each snapshot:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>select</span>
</span></span><span style=display:flex><span>    h.made_current_at,
</span></span><span style=display:flex><span>    s.<span style=color:#66d9ef>operation</span>,
</span></span><span style=display:flex><span>    h.snapshot_id,
</span></span><span style=display:flex><span>    h.is_current_ancestor,
</span></span><span style=display:flex><span>    s.summary[<span style=color:#e6db74>&#39;spark.app.id&#39;</span>]
</span></span><span style=display:flex><span><span style=color:#66d9ef>from</span> prod.db.<span style=color:#66d9ef>table</span>.history h
</span></span><span style=display:flex><span><span style=color:#66d9ef>join</span> prod.db.<span style=color:#66d9ef>table</span>.snapshots s
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>on</span> h.snapshot_id <span style=color:#f92672>=</span> s.snapshot_id
</span></span><span style=display:flex><span><span style=color:#66d9ef>order</span> <span style=color:#66d9ef>by</span> made_current_at
</span></span></code></pre></div><table><thead><tr><th>made_current_at</th><th>operation</th><th>snapshot_id</th><th>is_current_ancestor</th><th>summary[spark.app.id]</th></tr></thead><tbody><tr><td>2019-02-08 03:29:51.215</td><td>append</td><td>57897183625154</td><td>true</td><td>application_1520379288616_155055</td></tr><tr><td>2019-02-09 16:24:30.13</td><td>delete</td><td>29641004024753</td><td>false</td><td>application_1520379288616_151109</td></tr><tr><td>2019-02-09 16:32:47.336</td><td>append</td><td>57897183625154</td><td>true</td><td>application_1520379288616_155055</td></tr><tr><td>2019-02-08 03:47:55.948</td><td>overwrite</td><td>51792995261850</td><td>true</td><td>application_1520379288616_152431</td></tr></tbody></table><h3 id=files>Files</h3><p>To show a table&rsquo;s current files:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> prod.db.<span style=color:#66d9ef>table</span>.files;
</span></span></code></pre></div><table><thead><tr><th>content</th><th>file_path</th><th>file_format</th><th>spec_id</th><th>record_count</th><th>file_size_in_bytes</th><th>column_sizes</th><th>value_counts</th><th>null_value_counts</th><th>nan_value_counts</th><th>lower_bounds</th><th>upper_bounds</th><th>key_metadata</th><th>split_offsets</th><th>equality_ids</th><th>sort_order_id</th><th>readable_metrics</th></tr></thead><tbody><tr><td>0</td><td>s3:/&mldr;/table/data/00042-3-a9aa8b24-20bc-4d56-93b0-6b7675782bb5-00001.parquet</td><td>PARQUET</td><td>0</td><td>1</td><td>652</td><td>{1:52,2:48}</td><td>{1:1,2:1}</td><td>{1:0,2:0}</td><td>{}</td><td>{1:,2:d}</td><td>{1:,2:d}</td><td>NULL</td><td>[4]</td><td>NULL</td><td>0</td><td>{&ldquo;data&rdquo;:{&ldquo;column_size&rdquo;:48,&ldquo;value_count&rdquo;:1,&ldquo;null_value_count&rdquo;:0,&ldquo;nan_value_count&rdquo;:null,&ldquo;lower_bound&rdquo;:&ldquo;d&rdquo;,&ldquo;upper_bound&rdquo;:&ldquo;d&rdquo;},&ldquo;id&rdquo;:{&ldquo;column_size&rdquo;:52,&ldquo;value_count&rdquo;:1,&ldquo;null_value_count&rdquo;:0,&ldquo;nan_value_count&rdquo;:null,&ldquo;lower_bound&rdquo;:1,&ldquo;upper_bound&rdquo;:1}}</td></tr><tr><td>0</td><td>s3:/&mldr;/table/data/00000-0-f9709213-22ca-4196-8733-5cb15d2afeb9-00001.parquet</td><td>PARQUET</td><td>0</td><td>1</td><td>643</td><td>{1:46,2:48}</td><td>{1:1,2:1}</td><td>{1:0,2:0}</td><td>{}</td><td>{1:,2:a}</td><td>{1:,2:a}</td><td>NULL</td><td>[4]</td><td>NULL</td><td>0</td><td>{&ldquo;data&rdquo;:{&ldquo;column_size&rdquo;:48,&ldquo;value_count&rdquo;:1,&ldquo;null_value_count&rdquo;:0,&ldquo;nan_value_count&rdquo;:null,&ldquo;lower_bound&rdquo;:&ldquo;a&rdquo;,&ldquo;upper_bound&rdquo;:&ldquo;a&rdquo;},&ldquo;id&rdquo;:{&ldquo;column_size&rdquo;:46,&ldquo;value_count&rdquo;:1,&ldquo;null_value_count&rdquo;:0,&ldquo;nan_value_count&rdquo;:null,&ldquo;lower_bound&rdquo;:1,&ldquo;upper_bound&rdquo;:1}}</td></tr><tr><td>0</td><td>s3:/&mldr;/table/data/00001-1-f9709213-22ca-4196-8733-5cb15d2afeb9-00001.parquet</td><td>PARQUET</td><td>0</td><td>2</td><td>644</td><td>{1:49,2:51}</td><td>{1:2,2:2}</td><td>{1:0,2:0}</td><td>{}</td><td>{1:,2:b}</td><td>{1:,2:c}</td><td>NULL</td><td>[4]</td><td>NULL</td><td>0</td><td>{&ldquo;data&rdquo;:{&ldquo;column_size&rdquo;:51,&ldquo;value_count&rdquo;:2,&ldquo;null_value_count&rdquo;:0,&ldquo;nan_value_count&rdquo;:null,&ldquo;lower_bound&rdquo;:&ldquo;b&rdquo;,&ldquo;upper_bound&rdquo;:&ldquo;c&rdquo;},&ldquo;id&rdquo;:{&ldquo;column_size&rdquo;:49,&ldquo;value_count&rdquo;:2,&ldquo;null_value_count&rdquo;:0,&ldquo;nan_value_count&rdquo;:null,&ldquo;lower_bound&rdquo;:2,&ldquo;upper_bound&rdquo;:3}}</td></tr><tr><td>1</td><td>s3:/&mldr;/table/data/00081-4-a9aa8b24-20bc-4d56-93b0-6b7675782bb5-00001-deletes.parquet</td><td>PARQUET</td><td>0</td><td>1</td><td>1560</td><td>{2147483545:46,2147483546:152}</td><td>{2147483545:1,2147483546:1}</td><td>{2147483545:0,2147483546:0}</td><td>{}</td><td>{2147483545:,2147483546:s3:/&mldr;/table/data/00000-0-f9709213-22ca-4196-8733-5cb15d2afeb9-00001.parquet}</td><td>{2147483545:,2147483546:s3:/&mldr;/table/data/00000-0-f9709213-22ca-4196-8733-5cb15d2afeb9-00001.parquet}</td><td>NULL</td><td>[4]</td><td>NULL</td><td>NULL</td><td>{&ldquo;data&rdquo;:{&ldquo;column_size&rdquo;:null,&ldquo;value_count&rdquo;:null,&ldquo;null_value_count&rdquo;:null,&ldquo;nan_value_count&rdquo;:null,&ldquo;lower_bound&rdquo;:null,&ldquo;upper_bound&rdquo;:null},&ldquo;id&rdquo;:{&ldquo;column_size&rdquo;:null,&ldquo;value_count&rdquo;:null,&ldquo;null_value_count&rdquo;:null,&ldquo;nan_value_count&rdquo;:null,&ldquo;lower_bound&rdquo;:null,&ldquo;upper_bound&rdquo;:null}}</td></tr><tr><td>2</td><td>s3:/&mldr;/table/data/00047-25-833044d0-127b-415c-b874-038a4f978c29-00612.parquet</td><td>PARQUET</td><td>0</td><td>126506</td><td>28613985</td><td>{100:135377,101:11314}</td><td>{100:126506,101:126506}</td><td>{100:105434,101:11}</td><td>{}</td><td>{100:0,101:17}</td><td>{100:404455227527,101:23}</td><td>NULL</td><td>NULL</td><td>[1]</td><td>0</td><td>{&ldquo;id&rdquo;:{&ldquo;column_size&rdquo;:135377,&ldquo;value_count&rdquo;:126506,&ldquo;null_value_count&rdquo;:105434,&ldquo;nan_value_count&rdquo;:null,&ldquo;lower_bound&rdquo;:0,&ldquo;upper_bound&rdquo;:404455227527},&ldquo;data&rdquo;:{&ldquo;column_size&rdquo;:11314,&ldquo;value_count&rdquo;:126506,&ldquo;null_value_count&rdquo;: 11,&ldquo;nan_value_count&rdquo;:null,&ldquo;lower_bound&rdquo;:17,&ldquo;upper_bound&rdquo;:23}}</td></tr></tbody></table><div class=info>Content refers to type of content stored by the data file:
0 Data
1 Position Deletes
2 Equality Deletes</div><p>To show only data files or delete files, query <code>prod.db.table.data_files</code> and <code>prod.db.table.delete_files</code> respectively.
To show all files, data files and delete files across all tracked snapshots, query <code>prod.db.table.all_files</code>, <code>prod.db.table.all_data_files</code> and <code>prod.db.table.all_delete_files</code> respectively.</p><h3 id=manifests>Manifests</h3><p>To show a table&rsquo;s current file manifests:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> prod.db.<span style=color:#66d9ef>table</span>.manifests;
</span></span></code></pre></div><table><thead><tr><th>path</th><th>length</th><th>partition_spec_id</th><th>added_snapshot_id</th><th>added_data_files_count</th><th>existing_data_files_count</th><th>deleted_data_files_count</th><th>partition_summaries</th></tr></thead><tbody><tr><td>s3://&mldr;/table/metadata/45b5290b-ee61-4788-b324-b1e2735c0e10-m0.avro</td><td>4479</td><td>0</td><td>6668963634911763636</td><td>8</td><td>0</td><td>0</td><td>[[false,null,2019-05-13,2019-05-15]]</td></tr></tbody></table><p>Note:</p><ol><li>Fields within <code>partition_summaries</code> column of the manifests table correspond to <code>field_summary</code> structs within <a href=../../../spec#manifest-lists>manifest list</a>, with the following order:<ul><li><code>contains_null</code></li><li><code>contains_nan</code></li><li><code>lower_bound</code></li><li><code>upper_bound</code></li></ul></li><li><code>contains_nan</code> could return null, which indicates that this information is not available from the file&rsquo;s metadata.
This usually occurs when reading from V1 table, where <code>contains_nan</code> is not populated.</li></ol><h3 id=partitions>Partitions</h3><p>To show a table&rsquo;s current partitions:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> prod.db.<span style=color:#66d9ef>table</span>.partitions;
</span></span></code></pre></div><table><thead><tr><th>partition</th><th>spec_id</th><th>record_count</th><th>file_count</th><th>total_data_file_size_in_bytes</th><th>position_delete_record_count</th><th>position_delete_file_count</th><th>equality_delete_record_count</th><th>equality_delete_file_count</th><th>last_updated_at(Î¼s)</th><th>last_updated_snapshot_id</th></tr></thead><tbody><tr><td>{20211001, 11}</td><td>0</td><td>1</td><td>1</td><td>100</td><td>2</td><td>1</td><td>0</td><td>0</td><td>1633086034192000</td><td>9205185327307503337</td></tr><tr><td>{20211002, 11}</td><td>0</td><td>4</td><td>3</td><td>500</td><td>1</td><td>1</td><td>0</td><td>0</td><td>1633172537358000</td><td>867027598972211003</td></tr><tr><td>{20211001, 10}</td><td>0</td><td>7</td><td>4</td><td>700</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1633082598716000</td><td>3280122546965981531</td></tr><tr><td>{20211002, 10}</td><td>0</td><td>3</td><td>2</td><td>400</td><td>0</td><td>0</td><td>1</td><td>1</td><td>1633169159489000</td><td>6941468797545315876</td></tr></tbody></table><p>Note:</p><ol><li><p>For unpartitioned tables, the partitions table will not contain the partition and spec_id fields.</p></li><li><p>The partitions metadata table shows partitions with data files or delete files in the current snapshot. However, delete files are not applied, and so in some cases partitions may be shown even though all their data rows are marked deleted by delete files.</p></li></ol><h3 id=all-metadata-tables>All Metadata Tables</h3><p>These tables are unions of the metadata tables specific to the current snapshot, and return metadata across all snapshots.</p><div class=danger>The &ldquo;all&rdquo; metadata tables may produce more than one row per data file or manifest file because metadata files may be part of more than one table snapshot.</div><h4 id=all-data-files>All Data Files</h4><p>To show all of the table&rsquo;s data files and each file&rsquo;s metadata:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> prod.db.<span style=color:#66d9ef>table</span>.all_data_files;
</span></span></code></pre></div><table><thead><tr><th>content</th><th>file_path</th><th>file_format</th><th>partition</th><th>record_count</th><th>file_size_in_bytes</th><th>column_sizes</th><th>value_counts</th><th>null_value_counts</th><th>nan_value_counts</th><th>lower_bounds</th><th>upper_bounds</th><th>key_metadata</th><th>split_offsets</th><th>equality_ids</th><th>sort_order_id</th></tr></thead><tbody><tr><td>0</td><td>s3://&mldr;/dt=20210102/00000-0-756e2512-49ae-45bb-aae3-c0ca475e7879-00001.parquet</td><td>PARQUET</td><td>{20210102}</td><td>14</td><td>2444</td><td>{1 -> 94, 2 -> 17}</td><td>{1 -> 14, 2 -> 14}</td><td>{1 -> 0, 2 -> 0}</td><td>{}</td><td>{1 -> 1, 2 -> 20210102}</td><td>{1 -> 2, 2 -> 20210102}</td><td>null</td><td>[4]</td><td>null</td><td>0</td></tr><tr><td>0</td><td>s3://&mldr;/dt=20210103/00000-0-26222098-032f-472b-8ea5-651a55b21210-00001.parquet</td><td>PARQUET</td><td>{20210103}</td><td>14</td><td>2444</td><td>{1 -> 94, 2 -> 17}</td><td>{1 -> 14, 2 -> 14}</td><td>{1 -> 0, 2 -> 0}</td><td>{}</td><td>{1 -> 1, 2 -> 20210103}</td><td>{1 -> 3, 2 -> 20210103}</td><td>null</td><td>[4]</td><td>null</td><td>0</td></tr><tr><td>0</td><td>s3://&mldr;/dt=20210104/00000-0-a3bb1927-88eb-4f1c-bc6e-19076b0d952e-00001.parquet</td><td>PARQUET</td><td>{20210104}</td><td>14</td><td>2444</td><td>{1 -> 94, 2 -> 17}</td><td>{1 -> 14, 2 -> 14}</td><td>{1 -> 0, 2 -> 0}</td><td>{}</td><td>{1 -> 1, 2 -> 20210104}</td><td>{1 -> 3, 2 -> 20210104}</td><td>null</td><td>[4]</td><td>null</td><td>0</td></tr></tbody></table><h4 id=all-manifests>All Manifests</h4><p>To show all of the table&rsquo;s manifest files:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> prod.db.<span style=color:#66d9ef>table</span>.all_manifests;
</span></span></code></pre></div><table><thead><tr><th>path</th><th>length</th><th>partition_spec_id</th><th>added_snapshot_id</th><th>added_data_files_count</th><th>existing_data_files_count</th><th>deleted_data_files_count</th><th>partition_summaries</th></tr></thead><tbody><tr><td>s3://&mldr;/metadata/a85f78c5-3222-4b37-b7e4-faf944425d48-m0.avro</td><td>6376</td><td>0</td><td>6272782676904868561</td><td>2</td><td>0</td><td>0</td><td>[{false, false, 20210101, 20210101}]</td></tr></tbody></table><p>Note:</p><ol><li>Fields within <code>partition_summaries</code> column of the manifests table correspond to <code>field_summary</code> structs within <a href=../../../spec#manifest-lists>manifest list</a>, with the following order:<ul><li><code>contains_null</code></li><li><code>contains_nan</code></li><li><code>lower_bound</code></li><li><code>upper_bound</code></li></ul></li><li><code>contains_nan</code> could return null, which indicates that this information is not available from the file&rsquo;s metadata.
This usually occurs when reading from V1 table, where <code>contains_nan</code> is not populated.</li></ol><h3 id=references>References</h3><p>To show a table&rsquo;s known snapshot references:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> prod.db.<span style=color:#66d9ef>table</span>.refs;
</span></span></code></pre></div><table><thead><tr><th>name</th><th>type</th><th>snapshot_id</th><th>max_reference_age_in_ms</th><th>min_snapshots_to_keep</th><th>max_snapshot_age_in_ms</th></tr></thead><tbody><tr><td>main</td><td>BRANCH</td><td>4686954189838128572</td><td>10</td><td>20</td><td>30</td></tr><tr><td>testTag</td><td>TAG</td><td>4686954189838128572</td><td>10</td><td>null</td><td>null</td></tr></tbody></table><h3 id=inspecting-with-dataframes>Inspecting with DataFrames</h3><p>Metadata tables can be loaded using the DataFrameReader API:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#75715e>// named metastore table
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>spark<span style=color:#f92672>.</span>read<span style=color:#f92672>.</span>format<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;iceberg&#34;</span><span style=color:#f92672>).</span>load<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;db.table.files&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Hadoop path table
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>spark<span style=color:#f92672>.</span>read<span style=color:#f92672>.</span>format<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;iceberg&#34;</span><span style=color:#f92672>).</span>load<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;hdfs://nn:8020/path/to/table#files&#34;</span><span style=color:#f92672>)</span>
</span></span></code></pre></div><h3 id=time-travel-with-metadata-tables>Time Travel with Metadata Tables</h3><p>To inspect a tables&rsquo;s metadata with the time travel feature:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#75715e>-- get the table&#39;s file manifests at timestamp Sep 20, 2021 08:00:00
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> prod.db.<span style=color:#66d9ef>table</span>.manifests <span style=color:#66d9ef>TIMESTAMP</span> <span style=color:#66d9ef>AS</span> <span style=color:#66d9ef>OF</span> <span style=color:#e6db74>&#39;2021-09-20 08:00:00&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- get the table&#39;s partitions with snapshot id 10963874102873L
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> prod.db.<span style=color:#66d9ef>table</span>.partitions <span style=color:#66d9ef>VERSION</span> <span style=color:#66d9ef>AS</span> <span style=color:#66d9ef>OF</span> <span style=color:#ae81ff>10963874102873</span>;
</span></span></code></pre></div><p>Metadata tables can also be inspected with time travel using the DataFrameReader API:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#75715e>// load the table&#39;s file metadata at snapshot-id 10963874102873 as DataFrame
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>spark<span style=color:#f92672>.</span>read<span style=color:#f92672>.</span>format<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;iceberg&#34;</span><span style=color:#f92672>).</span>option<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;snapshot-id&#34;</span><span style=color:#f92672>,</span> <span style=color:#ae81ff>10963874102873L</span><span style=color:#f92672>).</span>load<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;db.table.files&#34;</span><span style=color:#f92672>)</span>
</span></span></code></pre></div></div><div id=toc class=markdown-body><div id=full><nav id=TableOfContents><ul><li><a href=#querying-with-sql>Querying with SQL</a></li><li><a href=#querying-with-dataframes>Querying with DataFrames</a><ul><li><a href=#catalogs-with-dataframereader>Catalogs with DataFrameReader</a></li><li><a href=#time-travel>Time travel</a></li><li><a href=#incremental-read>Incremental read</a></li></ul></li><li><a href=#inspecting-tables>Inspecting tables</a><ul><li><a href=#history>History</a></li><li><a href=#metadata-log-entries>Metadata Log Entries</a></li><li><a href=#snapshots>Snapshots</a></li><li><a href=#files>Files</a></li><li><a href=#manifests>Manifests</a></li><li><a href=#partitions>Partitions</a></li><li><a href=#all-metadata-tables>All Metadata Tables</a></li><li><a href=#references>References</a></li><li><a href=#inspecting-with-dataframes>Inspecting with DataFrames</a></li><li><a href=#time-travel-with-metadata-tables>Time Travel with Metadata Tables</a></li></ul></li></ul></nav></div></div></div></div></section></body><script src=https://iceberg.apache.org/docs/1.4.1//js/jquery-1.11.0.js></script><script src=https://iceberg.apache.org/docs/1.4.1//js/jquery.easing.min.js></script><script type=text/javascript src=https://iceberg.apache.org/docs/1.4.1//js/search.js></script><script src=https://iceberg.apache.org/docs/1.4.1//js/bootstrap.min.js></script><script src=https://iceberg.apache.org/docs/1.4.1//js/iceberg-theme.js></script></html>