<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=author content><title>Puffin Spec</title><link href=/css/bootstrap.css rel=stylesheet><link href=/css/markdown.css rel=stylesheet><link href=/css/katex.min.css rel=stylesheet><link href=/css/iceberg-theme.css rel=stylesheet><link href=/font-awesome-4.7.0/css/font-awesome.min.css rel=stylesheet type=text/css><link href="//fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic,700italic" rel=stylesheet type=text/css><link href=/css/termynal.css rel=stylesheet></head><body><head><script>function addAnchor(e){e.insertAdjacentHTML("beforeend",`<a href="#${e.id}" class="anchortag" ariaLabel="Anchor"> üîó </a>`)}document.addEventListener("DOMContentLoaded",function(){var e=document.querySelectorAll("h1[id], h2[id], h3[id], h4[id]");e&&e.forEach(addAnchor)})</script></head><nav class="navbar navbar-default" role=navigation><topsection><div class=navbar-fixed-top><div><button type=button class=navbar-toggle data-toggle=collapse data-target=div.sidebar>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span></button>
<a class="page-scroll navbar-brand" href=https://iceberg.apache.org/><img class=top-navbar-logo src=https://iceberg.apache.org//img/iceberg-logo-icon.png> Apache Iceberg</a></div><div><input type=search class=form-control id=search-input placeholder=Search... maxlength=64 data-hotkeys=s/></div><div class=versions-dropdown><span>1.4.0</span> <i class="fa fa-chevron-down"></i><div class=versions-dropdown-content><ul><li class=versions-dropdown-selection><a href=/docs/latest>latest</a></li><li class=versions-dropdown-selection><a href=/docs/1.4.0>1.4.0</a></li><li class=versions-dropdown-selection><a href=/docs/1.3.1>1.3.1</a></li><li class=versions-dropdown-selection><a href=/docs/1.3.0>1.3.0</a></li><li class=versions-dropdown-selection><a href=/docs/1.2.1>1.2.1</a></li><li class=versions-dropdown-selection><a href=/docs/1.2.0>1.2.0</a></li><li class=versions-dropdown-selection><a href=/docs/1.1.0>1.1.0</a></li><li class=versions-dropdown-selection><a href=/docs/1.0.0>1.0.0</a></li><li class=versions-dropdown-selection><a href=/docs/0.14.1>0.14.1</a></li><li class=versions-dropdown-selection><a href=/docs/0.14.0>0.14.0</a></li><li class=versions-dropdown-selection><a href=/docs/0.13.2>0.13.2</a></li><li class=versions-dropdown-selection><a href=/docs/0.13.1>0.13.1</a></li><li class=versions-dropdown-selection><a href=/docs/0.13.0>0.13.0</a></li><li class=versions-dropdown-selection><a href=/docs/0.12.1>0.12.1</a></li></ul></div></div></div><div class="navbar-menu-fixed-top navbar-pages-group"><div class=versions-dropdown><div class=topnav-page-selection><a href>Quickstart</a> <i class="fa fa-chevron-down"></i></div class="topnav-page-selection"><div class=versions-dropdown-content><ul><li class=topnav-page-selection><a href=/hive-quickstart>Hive</a></li class="topnav-page-selection"><li class=topnav-page-selection><a href=/spark-quickstart>Spark</a></li class="topnav-page-selection"></ul></div></div><div class=topnav-page-selection><a href=/docs/latest>Docs</a></div class="topnav-page-selection"><div class=topnav-page-selection><a href=/releases>Releases</a></div class="topnav-page-selection"><div class=topnav-page-selection><a href=/roadmap>Roadmap</a></div class="topnav-page-selection"><div class=topnav-page-selection><a href=/blogs>Blogs</a></div class="topnav-page-selection"><div class=topnav-page-selection><a href=/talks>Talks</a></div class="topnav-page-selection"><div class=topnav-page-selection><a href=/vendors>Vendors</a></div class="topnav-page-selection"><div class=versions-dropdown><div class=topnav-page-selection><a href>Project</a> <i class="fa fa-chevron-down"></i></div class="topnav-page-selection"><div class=versions-dropdown-content><ul><li class=topnav-page-selection><a href=/community>Join</a></li class="topnav-page-selection"><li class=topnav-page-selection><a href=/spec>Spec</a></li class="topnav-page-selection"><li class=topnav-page-selection><a href=/view-spec>View Spec</a></li class="topnav-page-selection"><li class=topnav-page-selection><a id=active href=/puffin-spec>Puffin Spec</a></li class="topnav-page-selection"><li class=topnav-page-selection><a href=/multi-engine-support>Multi-Engine Support</a></li class="topnav-page-selection"><li class=topnav-page-selection><a href=/how-to-release>How To Release</a></li class="topnav-page-selection"><li class=topnav-page-selection><a href=/terms>Terms</a></li class="topnav-page-selection"></ul></div></div><div class=versions-dropdown><div class=topnav-page-selection><a href>Concepts</a> <i class="fa fa-chevron-down"></i></div class="topnav-page-selection"><div class=versions-dropdown-content><ul><li class=topnav-page-selection><a href=https://iceberg.apache.org//catalog>Catalogs</a></li class="topnav-page-selection"></ul></div></div><div class=versions-dropdown><div class=topnav-page-selection><a href>ASF</a> <i class="fa fa-chevron-down"></i></div class="topnav-page-selection"><div class=versions-dropdown-content><ul><li class=topnav-page-selection><a target=_blank href=https://www.apache.org/foundation/sponsorship.html>Donate</a></li class="topnav-page-selection"><li class=topnav-page-selection><a target=_blank href=https://www.apache.org/events/current-event.html>Events</a></li class="topnav-page-selection"><li class=topnav-page-selection><a target=_blank href=https://www.apache.org/licenses/>License</a></li class="topnav-page-selection"><li class=topnav-page-selection><a target=_blank href=https://www.apache.org/security/>Security</a></li class="topnav-page-selection"><li class=topnav-page-selection><a target=_blank href=https://www.apache.org/foundation/thanks.html>Sponsors</a></li class="topnav-page-selection"></ul></div></div><div class=topnav-page-selection><a href=https://github.com/apache/iceberg target=_blank><img src=https://iceberg.apache.org//img/GitHub-Mark.png target=_blank class=top-navbar-logo></a></div><div class=topnav-page-selection><a href=https://join.slack.com/t/apache-iceberg/shared_invite/zt-2561tq9qr-UtISlHgsdY3Virs3Z2_btQ target=_blank><img src=https://iceberg.apache.org//img/Slack_Mark_Web.png target=_blank class=top-navbar-logo></a></div></div></topsection></nav><section><div id=search-results-container><ul id=search-results></ul></div></section><body dir=" ltr"><section><div class="grid-container toc-only"><div id=content class=markdown-body><div class=margin-for-toc><h1 id=puffin-file-format>Puffin file format</h1><p>This is a specification for Puffin, a file format designed to store
information such as indexes and statistics about data managed in an
Iceberg table that cannot be stored directly within the Iceberg manifest. A
Puffin file contains arbitrary pieces of information (here called &ldquo;blobs&rdquo;),
along with metadata necessary to interpret them. The blobs supported by Iceberg
are documented at <a href=#blob-types>Blob types</a>.</p><h2 id=format-specification>Format specification</h2><p>A file conforming to the Puffin file format specification should have the structure
as described below.</p><h3 id=versions>Versions</h3><p>Currently, there is a single version of the Puffin file format, described below.</p><h3 id=file-structure>File structure</h3><p>The Puffin file has the following structure</p><pre tabindex=0><code>Magic Blob‚ÇÅ Blob‚ÇÇ ... Blob‚Çô Footer
</code></pre><p>where</p><ul><li><code>Magic</code> is four bytes 0x50, 0x46, 0x41, 0x31 (short for: Puffin <em>Fratercula
arctica</em>, version 1),</li><li><code>Blob·µ¢</code> is i-th blob contained in the file, to be interpreted by application
according to the footer,</li><li><code>Footer</code> is defined below.</li></ul><h3 id=footer-structure>Footer structure</h3><p>Footer has the following structure</p><pre tabindex=0><code>Magic FooterPayload FooterPayloadSize Flags Magic
</code></pre><p>where</p><ul><li><code>Magic</code>: four bytes, same as at the beginning of the file</li><li><code>FooterPayload</code>: optionally compressed, UTF-8 encoded JSON payload describing the
blobs in the file, with the structure described below</li><li><code>FooterPayloadSize</code>: a length in bytes of the <code>FooterPayload</code> (after compression,
if compressed), stored as 4 byte integer</li><li><code>Flags</code>: 4 bytes for boolean flags<ul><li>byte 0 (first)<ul><li>bit 0 (lowest bit): whether <code>FooterPayload</code> is compressed</li><li>all other bits are reserved for future use and should be set to 0 on write</li></ul></li><li>all other bytes are reserved for future use and should be set to 0 on write</li></ul></li></ul><p>A 4 byte integer is always signed, in a two&rsquo;s complement representation, stored
little-endian.</p><h3 id=footer-payload>Footer Payload</h3><p>Footer payload bytes is either uncompressed or LZ4-compressed (as a single
<a href=https://github.com/lz4/lz4/blob/77d1b93f72628af7bbde0243b4bba9205c3138d9/doc/lz4_Frame_format.md>LZ4 compression frame</a>
with content size present), UTF-8 encoded JSON payload representing a single
<code>FileMetadata</code> object.</p><h4 id=filemetadata>FileMetadata</h4><p><code>FileMetadata</code> has the following fields</p><table><thead><tr><th>Field Name</th><th>Field Type</th><th>Required</th><th>Description</th></tr></thead><tbody><tr><td>blobs</td><td>list of BlobMetadata objects</td><td>yes</td><td></td></tr><tr><td>properties</td><td>JSON object with string property values</td><td>no</td><td>storage for arbitrary meta-information, like writer identification/version. See <a href=#common-properties>Common properties</a> for properties that are recommended to be set by a writer.</td></tr></tbody></table><h4 id=blobmetadata>BlobMetadata</h4><p><code>BlobMetadata</code> has the following fields</p><table><thead><tr><th>Field Name</th><th>Field Type</th><th>Required</th><th>Description</th></tr></thead><tbody><tr><td>type</td><td>JSON string</td><td>yes</td><td>See <a href=#blob-types>Blob types</a></td></tr><tr><td>fields</td><td>JSON list of ints</td><td>yes</td><td>List of field IDs the blob was computed for; the order of items is used to compute sketches stored in the blob.</td></tr><tr><td>snapshot-id</td><td>JSON long</td><td>yes</td><td>ID of the Iceberg table&rsquo;s snapshot the blob was computed from.</td></tr><tr><td>sequence-number</td><td>JSON long</td><td>yes</td><td>Sequence number of the Iceberg table&rsquo;s snapshot the blob was computed from.</td></tr><tr><td>offset</td><td>JSON long</td><td>yes</td><td>The offset in the file where the blob contents start</td></tr><tr><td>length</td><td>JSON long</td><td>yes</td><td>The length of the blob stored in the file (after compression, if compressed)</td></tr><tr><td>compression-codec</td><td>JSON string</td><td>no</td><td>See <a href=#compression-codecs>Compression codecs</a>. If omitted, the data is assumed to be uncompressed.</td></tr><tr><td>properties</td><td>JSON object with string property values</td><td>no</td><td>storage for arbitrary meta-information about the blob</td></tr></tbody></table><h3 id=blob-types>Blob types</h3><p>The blobs can be of a type listed below</p><h4 id=apache-datasketches-theta-v1-blob-type><code>apache-datasketches-theta-v1</code> blob type</h4><p>A serialized form of a &ldquo;compact&rdquo; Theta sketch produced by the <a href=https://datasketches.apache.org/>Apache
DataSketches</a> library. The sketch is obtained by
constructing Alpha family sketch with default seed, and feeding it with individual
distinct values converted to bytes using Iceberg&rsquo;s single-value serialization.</p><p>The blob metadata for this blob may include following properties:</p><ul><li><code>ndv</code>: estimate of number of distinct values, derived from the sketch.</li></ul><h3 id=compression-codecs>Compression codecs</h3><p>The data can also be uncompressed. If it is compressed the codec should be one of
codecs listed below. For maximal interoperability, other codecs are not supported.</p><table><thead><tr><th>Codec name</th><th>Description</th></tr></thead><tbody><tr><td>lz4</td><td>Single <a href=https://github.com/lz4/lz4/blob/77d1b93f72628af7bbde0243b4bba9205c3138d9/doc/lz4_Frame_format.md>LZ4 compression frame</a>, with content size present</td></tr><tr><td>zstd</td><td>Single <a href=https://github.com/facebook/zstd/blob/8af64f41161f6c2e0ba842006fe238c664a6a437/doc/zstd_compression_format.md#zstandard-frames>Zstandard compression frame</a>, with content size present</td></tr><tr><td>__</td><td></td></tr></tbody></table><h3 id=common-properties>Common properties</h3><p>When writing a Puffin file it is recommended to set the following fields in the
<a href=#filemetadata>FileMetadata</a>&rsquo;s <code>properties</code> field.</p><ul><li><code>created-by</code> - human-readable identification of the application writing the file,
along with its version. Example &ldquo;Trino version 381&rdquo;.</li></ul></div><div id=toc class=markdown-body><div id=full><nav id=TableOfContents><ul><li><a href=#format-specification>Format specification</a><ul><li><a href=#versions>Versions</a></li><li><a href=#file-structure>File structure</a></li><li><a href=#footer-structure>Footer structure</a></li><li><a href=#footer-payload>Footer Payload</a></li><li><a href=#blob-types>Blob types</a></li><li><a href=#compression-codecs>Compression codecs</a></li><li><a href=#common-properties>Common properties</a></li></ul></li></ul></nav></div></div></div></div></section></body><script src=https://iceberg.apache.org//js/jquery-1.11.0.js></script>
<script src=https://iceberg.apache.org//js/jquery.easing.min.js></script>
<script type=text/javascript src=https://iceberg.apache.org//js/search.js></script>
<script src=https://iceberg.apache.org//js/bootstrap.min.js></script>
<script src=https://iceberg.apache.org//js/iceberg-theme.js></script></html>